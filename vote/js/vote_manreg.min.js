jQuery(document).ready(function(b){var a=b("#statusdiv");b(".error").hide();votejs.init();a.hide();b("#vote_code").on("keyup focusout",function(d){var c=b(this).val();if(d.type=="keyup"&&c.length<3){return false}else{if(d.type=="focusout"&&c.length<3){a.html('<div class="infobar infobar-warning" data-mini="true">Kod ska vara 3 tecken!</div>');a.fadeIn()}else{votejs.preCodeCheck()}}return false});b(".voteform_trigger").on("submit",function(c){c.preventDefault();votejs.postvotes(0);return false});b(function(){b("input[type=submit], a, button, input").button().css({"text-align":"left",outline:"none",cursor:"auto"})})});votejs=function(){var g=false;var c=0;var j=true;var o=0;var e=false;var p=false;var m=9999;var d=null;var r=[];var h="";function f(){$.ajax({type:"POST",url:"./php/jssettings.php",dataType:"json",cache:false,async:false,data:{operation:"getjssettings",source:"index.php",subset:""},success:function(t){if(t.msgtype=="ok"){g=t.CONST_SYS_JS_DEBUG;p=t.REQUEST_SYSSTATUS;m=t.SETTING_SYSSTATUS_INTERVAL;c=t.CONST_SETTING_VOTES_PER_CATEGORY_SAME;j=t.CONST_SETTING_VOTES_PER_CATEGORY_SAME_REQUIRE_ALL;o=t.CONST_SETTING_VOTES_PER_CATEGORY;e=t.CONST_SETTING_VOTES_PER_CATEGORY_REQUIRE_ALL;if(g){console.log(t)}r=t.CONST_SETTING_CATEGORIES_SYS;var u=t.SETTING_COMPETITION_NAME;$("#competition_header").text(u)}else{printInfobar("#statusdiv","warning","serverfel 1-1",true)}},error:function(v,t,u){printInfobar("#statusdiv","warning","serverfel 1-2",true)}})}function b(){var t=false;$.ajax({type:"POST",url:"./php/manreg_ajax.php",dataType:"json",cache:false,data:{operation:"mr_reread",source:"manregp.php",vote_code:$("#vote_code").val()},success:function(u){if(g){console.log(u)}if(u.novotes==null){printInfobar("#statusdiv",u.msgtype,"Dina befintliga röster läses in.");$("#statusdiv").fadeOut(3500)}$.each(r,function(v,w){for(i=1;i<=o;i++){$("#"+w+"_vote"+i).val(u["vote_"+i+"_"+w])}})},error:function(w,u,v){if(g){alert("serverfel 1-3, reread: "+u+w+v)}}});return t}function l(t){if(p==true){$.ajax({type:"POST",url:"./php/vote_ajax.php",dataType:"json",cache:false,data:{operation:"sysstatus",source:"index.php",my_interval:m},success:function(u){if(g){console.log(u)}if(u.msgtype=="interval"&&d!=null){clearInterval(d);m=u.interval;d=window.setInterval(l,u.interval)}else{if(u.msgtype=="stop"){$("#sysbar").hide();p=false}else{if(u.usrmsg.length>0){printInfobar("#sysbar",u.msgtype,u.usrmsg)}else{$("#sysbar").hide()}}}},error:function(w,u,v){}})}}function a(){$.ajax({type:"POST",url:"./php/manreg_ajax.php",dataType:"json",cache:false,data:{operation:"mr_pre_codecheck",source:"manreg.php",vote_code:$("#vote_code").val()},success:function(t){if(g){console.log(t)}if(t.msgtype=="ok"){if(h!=$("#vote_code").val()){$("#vote_code").val(t.vote_code);h=$("#vote_code").val();s(true);$("#statusdiv").hide();b()}}else{if(t.usrmsg!=null){printInfobar("#statusdiv",t.msgtype,t.usrmsg);h=""}}},error:function(v,t,u){if(g){alert("serverfel 1-4, preCodeCheck: "+t+v+u)}}})}function s(u){if(!u){$("#vote_code").val("");h=""}var t=$("#voteregform");$("div.vote_category",t).each(function(){var v=$(this).attr("id");var w=1;$("li",$(this)).each(function(){var x=$(this).find("input");if(x!=null){x.val("")}})});$("#vote_code").focus()}function k(){var v=$("#vote_code").val();var x=[];var w=0;var u=$("#voteregform");$("div.vote_category",u).each(function(){var y=$(this).attr("id");var z=1;$("li",$(this)).each(function(){var B=$(this).find("input");if(B!=null){var A=B.val();w++;var C="vote_"+z+++"_"+y;x.push({voteid:C,vote:A})}})});var t={vote_code:v,operation:"mr_post_votes_public",source:"manreg.php"};$.each(x,function(z,y){t[y.voteid]=y.vote});return t}function n(w){var v=$(this);var u=$("#vote_code").val();var x=$(".formstatus_trigger",v);var t=k();t.confirmed_error=w;$.ajax({type:"POST",url:"./php/manreg_ajax.php",dataType:"json",cache:false,data:t,success:function(z){if(g){console.log(z)}var B=$("#form_submit_status");var y=z.usrmsg.replace("\n","<br>");var A=z.msgtype;if(y.length>0&&(A=="warning"||A=="error")){y='<div class="infobar infobar-neutral" style=" margin-bottom: 1em"><b>Fel upptäckta. Försök igen. <br>Felen visas nedan:</div>'+y;$(B).html('<div class="infobar infobar-warning" data-mini="true">'+y+"</div>");if($(B).is(":visible")){$(B).fadeOut()}$(B).fadeIn()}else{$(B).html('<div class="infobar infobar-ok" data-mini="true">'+y+"</div>");$(B).fadeIn().delay(300).fadeOut(3000);s()}},error:function(A,y,z){if(g){console.log("error, post_vote:"+A+","+y+","+z)}x.html("serverfel 1-5: "+y);x.fadeToggle()}})}function q(){f();s();d=window.setInterval(l,m);l()}return{init:q,preCodeCheck:a,postvotes:n}}();