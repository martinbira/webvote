jQuery(document).ready(function(b){var a=b("#statusdiv");b(".error").hide();votejs.init();a.hide();b("#vote_code").on("keyup focusout",function(d){var c=b(this).val();if(d.type=="keyup"&&c.length<3){return false}else{if(d.type=="focusout"&&c.length<3){a.html('<div class="infobar infobar-warning" data-mini="true">Kod ska vara 3 tecken!</div>');a.fadeIn()}else{votejs.preCodeCheck()}}return false});b(".voteform_trigger").on("submit",function(c){c.preventDefault();votejs.postvotes(0);return false});b("#error_corr").on("click",function(c){c.preventDefault();votejs.postvotes(1);return false});b("#error_ack").on("click",function(c){c.preventDefault();votejs.postvotes(2);return false});b(function(){b("input[type=submit], a, button, input").button().css({"text-align":"left",outline:"none",cursor:"auto"})})});votejs=function(){var d=false;var h=0;var b=true;var a=0;var f=false;function g(){$.ajax({type:"POST",url:"./php/jssettings.php",dataType:"json",cache:false,async:false,data:{operation:"getjssettings",source:"index.php",subset:""},success:function(l){if(l.msgtype=="ok"){d=l.CONST_SYS_JS_DEBUG;h=l.CONST_SETTING_VOTES_PER_CATEGORY_SAME;b=l.CONST_SETTING_VOTES_PER_CATEGORY_SAME_REQUIRE_ALL;a=l.CONST_SETTING_VOTES_PER_CATEGORY;f=l.CONST_SETTING_VOTES_PER_CATEGORY_REQUIRE_ALL;if(d){console.log(l)}var m=l.SETTING_COMPETITION_NAME;$("#competition_header").text(m)}else{printInfobar("#statusdiv","warning","serverfel 1-1",true)}},error:function(n,l,m){printInfobar("#statusdiv","warning","serverfel 1-2",true)}})}function k(){$.ajax({type:"POST",url:"./php/manreg_ajax.php",dataType:"json",cache:false,data:{operation:"mr_pre_codecheck",source:"manreg_adm.php",vote_code:$("#vote_code").val()},success:function(l){if(d){console.log(l)}if(l.msgtype=="ok"){$("#vote_code").val(l.vote_code);$("#statusdiv").fadeOut()}else{if(l.usrmsg!=null){printInfobar("#statusdiv",l.msgtype,l.usrmsg,true)}}},error:function(n,l,m){if(d){alert("serverfel, preCodeCheck: "+l+n+m)}}})}function j(){$("#vote_code").val("");var l=$("#voteregform");$("div.vote_category",l).each(function(){var m=$(this).attr("id");var n=1;$("li",$(this)).each(function(){var o=$(this).find("input");if(o!=null){o.val("")}})});$("#vote_code").focus()}function c(){var n=$("#vote_code").val();var p=[];var o=0;var m=$("#voteregform");$("div.vote_category",m).each(function(){var q=$(this).attr("id");var r=1;$("li",$(this)).each(function(){var t=$(this).find("input");if(t!=null){var s=t.val();o++;var u="vote_"+r+++"_"+q;p.push({voteid:u,vote:s})}})});var l={vote_code:n,operation:"mr_post_votes",source:"manreg.php"};$.each(p,function(r,q){l[q.voteid]=q.vote});return l}function e(o){var n=$(this);var m=$("#vote_code").val();var p=$(".formstatus_trigger",n);var l=c();l.confirmed_error=o;$.ajax({type:"POST",url:"./php/manreg_ajax.php",dataType:"json",cache:false,data:l,success:function(r){if(d){console.log(r)}var t=$("#form_submit_status");var q=r.usrmsg.replace("\n","<br>");var s=r.msgtype;if(q.length>0&&(s=="warning"||s=="error")){q="<div class=\"infobar infobar-neutral\" style=\" margin-bottom: 1em\"><b>Fel upptäckta. Dubbelkolla att <i>DU</i> som funktionär matat in exakt vad som står på inlämnat röstkort.</b><br>--Tryck 'Bekräfta fel' om felet finns även på inlämnat röstkort. <br>--Eller rätta till och tryck sedan 'Korrigera' om felet berodde på att <i>DU</i> skrev av röstkortet fel.<br>Felen visas nedan:</div>"+q;$(t).html('<div class="infobar infobar-warning" data-mini="true">'+q+"</div>");if($(t).is(":visible")){$(t).fadeOut()}$(t).fadeIn();$("#err_butts").show();$("#submit_votes").hide();$("#error_ack").focus()}else{$(t).html('<div class="infobar infobar-ok" data-mini="true">'+q+"</div>");$(t).fadeIn().delay(300).fadeOut(1000);$("#err_butts").hide();$("#submit_votes").show();j();$("#vote_code_label").fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100)}},error:function(s,q,r){if(d){console.log("error, post_vote:"+s+","+q+","+r)}p.html("serverfel: "+q);p.fadeToggle()}})}function i(){g();j()}return{init:i,clearVoteFields:j,preCodeCheck:k,postvotes:e}}();